<div class="container mt-4">
  <h2>{{ isEditMode ? 'Edit' : 'Add' }} Patient</h2>
  
  <form (ngSubmit)="onSubmit()" #patientForm="ngForm" novalidate>
    
    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">First Name <span class="text-danger">*</span></label>
        <input 
          type="text" 
          class="form-control" 
          [(ngModel)]="patient.firstName" 
          name="firstName" 
          required 
          minlength="2"
          #firstNameModel="ngModel"
          [class.is-invalid]="firstNameModel.invalid && (firstNameModel.dirty || firstNameModel.touched)"
        >
        <div class="invalid-feedback" *ngIf="firstNameModel.errors?.['required']">
          First Name is required.
        </div>
        <div class="invalid-feedback" *ngIf="firstNameModel.errors?.['minlength']">
          Minimum 2 characters required.
        </div>
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label">Last Name <span class="text-danger">*</span></label>
        <input 
          type="text" 
          class="form-control" 
          [(ngModel)]="patient.lastName" 
          name="lastName" 
          required 
          #lastNameModel="ngModel"
          [class.is-invalid]="lastNameModel.invalid && (lastNameModel.dirty || lastNameModel.touched)"
        >
        <div class="invalid-feedback">Last Name is required.</div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">Date of Birth <span class="text-danger">*</span></label>
        <input 
          type="date" 
          class="form-control" 
          [(ngModel)]="patient.dateOfBirth" 
          name="dateOfBirth" 
          required
          #dobModel="ngModel"
          [class.is-invalid]="dobModel.invalid && (dobModel.dirty || dobModel.touched)"
        >
        <div class="invalid-feedback">Date of Birth is required.</div>
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label">Gender <span class="text-danger">*</span></label>
        <select 
          class="form-select" 
          [(ngModel)]="patient.gender" 
          name="gender" 
          required
          #genderModel="ngModel"
          [class.is-invalid]="genderModel.invalid && (genderModel.dirty || genderModel.touched)"
        >
          <option value="" disabled selected>Select Gender</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
        </select>
        <div class="invalid-feedback">Please select a gender.</div>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Phone Number <span class="text-danger">*</span></label>
      <input 
        type="text" 
        class="form-control" 
        [(ngModel)]="patient.phoneNumber" 
        name="phoneNumber" 
        required
        pattern="^[0-9]*$"
        #phoneModel="ngModel"
        [class.is-invalid]="phoneModel.invalid && (phoneModel.dirty || phoneModel.touched)"
      >
      <div class="invalid-feedback" *ngIf="phoneModel.errors?.['required']">
        Phone number is required.
      </div>
      <div class="invalid-feedback" *ngIf="phoneModel.errors?.['pattern']">
        Only numbers are allowed.
      </div>
    </div>
    
    <h3>Address</h3>
    
    <div class="mb-3">
      <label class="form-label">Street Address <span class="text-danger">*</span></label>
      <input 
        type="text" 
        class="form-control" 
        [(ngModel)]="patient.address" 
        name="address" 
        required
        #addrModel="ngModel"
        [class.is-invalid]="addrModel.invalid && (addrModel.dirty || addrModel.touched)"
      >
      <div class="invalid-feedback">Street address is required.</div>
    </div>
    
    <div class="row">
      <div class="col-md-4 mb-3">
        <label class="form-label">Suburb <span class="text-danger">*</span></label>
        <input 
          type="text" 
          class="form-control" 
          [(ngModel)]="patient.suburb" 
          name="suburb" 
          required
          #suburbModel="ngModel"
          [class.is-invalid]="suburbModel.invalid && (suburbModel.dirty || suburbModel.touched)"
        >
        <div class="invalid-feedback">Suburb is required.</div>
      </div>

      <div class="col-md-4 mb-3">
        <label class="form-label">State <span class="text-danger">*</span></label>
        <input 
          type="text" 
          class="form-control" 
          [(ngModel)]="patient.state" 
          name="state" 
          required
          #stateModel="ngModel"
          [class.is-invalid]="stateModel.invalid && (stateModel.dirty || stateModel.touched)"
        >
        <div class="invalid-feedback">State is required.</div>
      </div>

      <div class="col-md-4 mb-3">
        <label class="form-label">Postcode <span class="text-danger">*</span></label>
        <input 
          type="text" 
          class="form-control" 
          [(ngModel)]="patient.postcode" 
          name="postcode" 
          required
          #postcodeModel="ngModel"
          [class.is-invalid]="postcodeModel.invalid && (postcodeModel.dirty || postcodeModel.touched)"
        >
        <div class="invalid-feedback">Postcode is required.</div>
      </div>
    </div>

    <div class="mt-3">
      <button 
        type="submit" 
        class="btn btn-primary me-2" 
        [disabled]="!patientForm.form.valid"
      >
        <i class="bi bi-save"></i> Save Patient
      </button>
      
      <button type="button" class="btn btn-secondary" routerLink="/">
        Cancel
      </button>
    </div>
    
  </form>
</div>